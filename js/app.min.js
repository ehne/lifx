/*
    Written by https://ryncmrfrd.me.
*/
var selector,currentLight_HadColor,lifx={auth:"",start:function(o,e,l){$.ajax({url:"https://api.lifx.com/v1/lights/all",headers:{Authorization:"Bearer "+o},success:function(l){lifx.auth=o,l?lifx.callback(e,l):lifx.callback(e)},error:function(o){l&&lifx.callback(l,o)}})},get:function(o,e,l){lifx.auth&&$.ajax({url:"https://api.lifx.com/v1/lights/"+o,headers:{Authorization:"Bearer "+lifx.auth},success:function(o){o?lifx.callback(e,o):lifx.callback(e)},error:function(o){l&&lifx.callback(l,o)}})},toggle:function(o,e){lifx.auth&&$.ajax({url:"https://api.lifx.com/v1/lights/id:"+o+"/toggle",headers:{Authorization:"Bearer "+lifx.auth},type:"POST",contentType:"application/json",success:function(o){var l=o.results;o?lifx.callback(e,l):lifx.callback(e)},error:function(o){errCBK&&lifx.callback(errCBK,o)}})},changeState:function(o,e,l,a){lifx.auth&&$.ajax({url:"https://api.lifx.com/v1/lights/id:"+o+"/state",headers:{Authorization:"Bearer "+lifx.auth},type:"PUT",dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify(e),success:function(o){lifx.callback(l,o)},error:function(o){a&&lifx.callback(a,o)}})},callback:function(o,e){0==arguments.length?console.error("Incorrect function parameters"):e?o(e):o()}};function startApp(o){$("#toggle i").hide(),lifx.start(o,function(o){if($("#logoutBtn").click(function(){localStorage.setItem("lifxAuthKey",""),window.location.href="login"}),$("#select").empty(),$.each(o,function(e){1==o[e].connected?$("#select").append("<option value="+o[e].id+" >"+o[e].label+"</option>"):$("#select").append("<option disabled>"+o[e].label+" &#x26A0</option>")}),(selector=$("#select").val())||(alert("oof"),$("#noLights").fadeIn(),$("#toggle").prop("disabled",!0)),$("#toggle i").hide(),"on"==o[0].power?($("#on").show(),$("#off").hide()):($("#off").show(),$("#on").hide()),currentLight_HadColor=o[0].product.capabilities.has_color,$("#kelvin").val(o[0].color.kelvin),$("#color").val(o[0].color.hue),currentLight_HadColor?($("#kelvin").fadeIn(),$("#color").css("opacity","1")):($("#kelvin").fadeIn(),$("#color").css("opacity","0")),1==o[0].color.saturation)$("body").css("background","hsla("+o[0].color.hue+", 100%, 50%, 1)");else{var e=colorTemperature2rgb(o[0].color.kelvin);$("body").css("background","rgb("+e.red+","+e.green+","+e.blue+")")}$("footer, main").fadeIn()})}function colorTemperature2rgb(o){var e,l,a,t=o/100;return t<66?e=255:((e=351.97690566805693+.114206453784165*(e=t-55)-40.25366309332127*Math.log(e))<0&&(e=0),e>255&&(e=255)),t<66?((l=-155.25485562709179-.44596950469579133*(l=t-2)+104.49216199393888*Math.log(l))<0&&(l=0),l>255&&(l=255)):((l=325.4494125711974+.07943456536662342*(l=t-50)-28.0852963507957*Math.log(l))<0&&(l=0),l>255&&(l=255)),t>=66?a=255:t<=20?a=0:((a=.8274096064007395*(a=t-10)-254.76935184120902+115.67994401066147*Math.log(a))<0&&(a=0),a>255&&(a=255)),{red:Math.round(e),green:Math.round(l),blue:Math.round(a)}}$("#select").change(function(){selector=$("#select").val(),lifx.get(selector,function(o){if($("#toggle i").hide(),"on"==o[0].power?($("#on").show(),$("#off").hide()):($("#off").show(),$("#on").hide()),currentLight_HadColor=o[0].product.capabilities.has_color,$("#kelvin").val(o[0].color.kelvin),$("#color").val(o[0].color.hue),currentLight_HadColor?($("#kelvin").fadeIn(),$("#color").css("opacity","1")):($("#kelvin").fadeIn(),$("#color").css("opacity","0")),1==o[0].color.saturation)$("body").css("background","hsla("+o[0].color.hue+", 100%, 50%, 1)");else{var e=colorTemperature2rgb(o[0].color.kelvin);$("body").css("background","rgb("+e.red+","+e.green+","+e.blue+")")}})}),$("#toggle").click(function(){var o=$("#on").is(":visible");$("#loader").show(),$("#on,#off").hide(),lifx.toggle(selector,function(){$("#loader").hide(),o?($("#off").show(),$("#on").hide()):($("#on").show(),$("#off").hide())})}),$("#kelvin").change(function(){var o={color:"kelvin:"+$("#kelvin").val()},e=$("#kelvin").val();lifx.changeState(selector,o,function(){var o=colorTemperature2rgb(e);$("body").css("background","rgb("+o.red+","+o.green+","+o.blue+")")})}),$("#color").change(function(){console.log("hue:"+$("#color").val());var o={color:"hue:"+$("#color").val()+" saturation:1.0 brightness:1"};lifx.changeState(selector,o,function(){$("body").css("background","hsla("+$("#color").val()+", 100%, 50%, 1)")})});