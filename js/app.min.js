var selector,currentLight_HadColor,lifx={auth:"",start:function(e,o,l){$.ajax({url:"https://api.lifx.com/v1/lights/all",headers:{Authorization:"Bearer "+e},success:function(l){lifx.auth=e,l?lifx.callback(o,l):lifx.callback(o)},error:function(e){l&&lifx.callback(l,e)}})},get:function(e,o,l){lifx.auth&&$.ajax({url:"https://api.lifx.com/v1/lights/"+e,headers:{Authorization:"Bearer "+lifx.auth},success:function(e){e?lifx.callback(o,e):lifx.callback(o)},error:function(e){l&&lifx.callback(l,e)}})},toggle:function(e,o){lifx.auth&&$.ajax({url:"https://api.lifx.com/v1/lights/id:"+e+"/toggle",headers:{Authorization:"Bearer "+lifx.auth},type:"POST",contentType:"application/json",success:function(e){var l=e.results;e?lifx.callback(o,l):lifx.callback(o)},error:function(e){errCBK&&lifx.callback(errCBK,e)}})},changeState:function(e,o,l,a){lifx.auth&&$.ajax({url:"https://api.lifx.com/v1/lights/id:"+e+"/state",headers:{Authorization:"Bearer "+lifx.auth},type:"PUT",dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify(o),success:function(e){lifx.callback(l,e)},error:function(e){a&&lifx.callback(a,e)}})},callback:function(e,o){0==arguments.length?console.error("Incorrect function parameters"):o?e(o):e()}};function startApp(e){$("i").hide(),lifx.start(e,function(e){$(".logout").click(function(){localStorage.setItem("lifxAuthKey",""),window.location.href="login"}),$(".app-select").empty(),$.each(e,function(o){1==e[o].connected?$(".app-select").append("<option value="+e[o].id+" >"+e[o].label+"</option>"):$(".app-select").append("<option disabled>"+e[o].label+" &#x26A0</option>")}),selector=$(".app-select").val(),(currentLight_HadColor=e[0].product.capabilities.has_color)?($(".Kelvin").val(e[0].color.kelvin),$(".Color").val(e[0].color.kelvin)):($(".Kelvin").val(e[0].color.kelvin),$(".Color").hide()),"on"==e[0].power?($("#on").show(),$("#off").hide()):($("#off").show(),$("#on").hide());var o=100*Number(e[0].brightness);$(".brightness").val(o);var l=colorTemperature2rgb(e[0].color.kelvin);$("body").css("background","rgb("+l.red+","+l.green+","+l.blue+")"),$(".app-container, .logout").fadeIn()})}function updateLights(e){lifx.get("id:"+e,function(e){$("i").hide(),"on"==e[0].power?($("#on").show(),$("#off").hide()):($("#off").show(),$("#on").hide()),currentLight_HadColor=e[0].product.capabilities.has_color,$(".Kelvin").val(e[0].color.kelvin),$(".Color").val(e[0].color.kelvin),currentLight_HadColor?$(".Color, .Kelvin").fadeIn():($(".Kelvin").fadeIn(),$(".Color").fadeOut());var o=100*Number(e[0].brightness);$(".brightness").val(o);var l=colorTemperature2rgb(e[0].color.kelvin);$("body").css("background","rgb("+l.red+","+l.green+","+l.blue+")")})}function colorTemperature2rgb(e){var o,l,a,t=e/100;return t<66?o=255:((o=351.97690566805693+.114206453784165*(o=t-55)-40.25366309332127*Math.log(o))<0&&(o=0),o>255&&(o=255)),t<66?((l=-155.25485562709179-.44596950469579133*(l=t-2)+104.49216199393888*Math.log(l))<0&&(l=0),l>255&&(l=255)):((l=325.4494125711974+.07943456536662342*(l=t-50)-28.0852963507957*Math.log(l))<0&&(l=0),l>255&&(l=255)),t>=66?a=255:t<=20?a=0:((a=.8274096064007395*(a=t-10)-254.76935184120902+115.67994401066147*Math.log(a))<0&&(a=0),a>255&&(a=255)),{red:Math.round(o),blue:Math.round(a),green:Math.round(l)}}$(".app-select").change(function(){selector=$(".app-select").val(),updateLights($(".app-select").val())}),$(".toggle-icons").click(function(){var e=$("#on").is(":visible");$("#loader").show(),$("#on,#off").hide(),lifx.toggle(selector,function(){$("#loader").hide(),e?($("#off").show(),$("#on").hide()):($("#on").show(),$("#off").hide())})}),$(".Kelvin").change(function(){var e={color:"kelvin:"+$(".Kelvin").val()},o=$(".Kelvin").val();lifx.changeState(selector,e,function(){var e=colorTemperature2rgb(o);$("body").css("background","rgb("+e.red+","+e.green+","+e.blue+")")})}),$(".Color").change(function(){console.log("changed color")}),$(document).on("input",".Kelvin",function(){var e=colorTemperature2rgb($(".Kelvin").val());$("body").css("background","rgb("+e.red+","+e.green+","+e.blue+")")}),$(".brightness").change(function(){lifx.changeState(selector,{brightness:$(".brightness").val()/100,power:"on"})});